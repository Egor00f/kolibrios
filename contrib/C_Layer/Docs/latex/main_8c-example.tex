\doxysection{main.\+c}
\hypertarget{main_8c-example}{}\label{main_8c-example}\begin{DoxyAuthor}{Author}
turbocat2001 (Logaev Maxim)
\end{DoxyAuthor}
example of using libimg library


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{/*\ Written\ by\ turbocat2001\ (Logaev\ Maxim)\ */}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <stddef.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <kos32sys.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{kolibri__gui_8h}{kolibri\_gui.h}}>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{kolibri__libimg_8h}{kolibri\_libimg.h}}>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#define\ NEW\_IMG\_H\ 128\ }}
\DoxyCodeLine{\textcolor{preprocessor}{\#define\ NEW\_IMG\_W\ 128}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#define\ IMG\_H\ 256}}
\DoxyCodeLine{\textcolor{preprocessor}{\#define\ IMG\_W\ 256}}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{struct_image}{Image}}\ *image\_blend;\ \textcolor{comment}{//\ Create\ image\ struct}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{struct\ }\mbox{\hyperlink{structkolibri__system__colors}{kolibri\_system\_colors}}\ sys\_color\_table;\ \ \textcolor{comment}{//\ Create\ system\ colors\ table}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{char}*\ load\_img(\textcolor{keywordtype}{char}*\ fname,\ int32\_t*\ read\_sz)\{\ \ \textcolor{comment}{//\ Image\ file\ upload\ function}}
\DoxyCodeLine{\ \ \ \ FILE\ *f\ =\ fopen(fname,\ \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (!f)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Can't\ open\ file:\ \%s\(\backslash\)n"{}},\ fname);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ exit(0);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (fseek(f,\ 0,\ SEEK\_END))\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Can't\ SEEK\_END\ file:\ \%s\(\backslash\)n"{}},\ fname);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ exit(0);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ filesize\ =\ ftell(f);}
\DoxyCodeLine{\ \ \ \ rewind(f);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{char}*\ fdata\ =\ malloc(filesize);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}(!fdata)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}No\ memory\ for\ file\ \%s\(\backslash\)n"{}},\ fname);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ exit(0);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ *read\_sz\ =\ fread(fdata,\ 1,\ filesize,\ f);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (ferror(f))\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ reading\ file\ \%s\(\backslash\)n"{}},\ fname);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ exit(0);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ fclose(f);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ fdata;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ DrawGUI()\{}
\DoxyCodeLine{\ \ \ \ begin\_draw();}
\DoxyCodeLine{\ \ \ \ sys\_create\_window(10,\ 40,\ (IMG\_W+NEW\_IMG\_W)+50,\ IMG\_H+50,\ \textcolor{stringliteral}{"{}Libimg"{}},\ sys\_color\_table.work\_area,\ 0x34);}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{kolibri__libimg_8h_acff45b1986af0d6ce7af0949c8457932}{img\_draw}}(image\_blend,\ 10,\ 10,\ IMG\_W*2,\ IMG\_H\ ,\ 0,\ 0);\ \ \textcolor{comment}{//\ Draw\ blended\ image\ to\ window}}
\DoxyCodeLine{\ \ \ \ end\_draw();}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ main()\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{kolibri__libimg_8h_a48d1fa50e5dd5ae820b4a05b4a59b939}{kolibri\_libimg\_init}}()\ ==\ -\/1)\{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ loading\ lib\_img.obj\(\backslash\)n"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ exit(0);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ get\_system\_colors(\&sys\_color\_table);\ \textcolor{comment}{//\ Get\ system\ colors\ theme}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ uint32\_t\ img\_size;\ }
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{void}\ *file\_data\ =\ load\_img(\textcolor{stringliteral}{"{}logo.png"{}},\ \&img\_size);\ \textcolor{comment}{//\ Get\ RAW\ data\ and\ size\ }}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{struct_image}{Image}}*\ image\ =\ \mbox{\hyperlink{kolibri__libimg_8h_a0254ed9142c6e35742695ed00548cc6e}{img\_decode}}(file\_data,\ img\_size,\ 0);\ \textcolor{comment}{//\ Decode\ RAW\ data\ to\ Image\ data}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (image-\/>\mbox{\hyperlink{struct_image_a140acdd7ac30628e97d1851104f05c03}{Type}}\ !=\ \mbox{\hyperlink{kolibri__libimg_8h_ae932abe1baf2fc58d0433104a97afa46afc1f7da9bb85078e43dad49072b4effe}{IMAGE\_BPP32}})\ \{\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ image\ =\ \mbox{\hyperlink{kolibri__libimg_8h_ad21764b5a9c1d6aed4bc2432afb3c3ee}{img\_convert}}(image,\ NULL,\ \mbox{\hyperlink{kolibri__libimg_8h_ae932abe1baf2fc58d0433104a97afa46afc1f7da9bb85078e43dad49072b4effe}{IMAGE\_BPP32}},\ 0,\ 0);\ \textcolor{comment}{//\ Convert\ image\ to\ format\ BPP32}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!image)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Convert\ error!:\ \(\backslash\)n"{}});\ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ exit(0);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ image\_blend\ =\ \mbox{\hyperlink{kolibri__libimg_8h_a3bf9d48a81c8ff386d2d279c09dad526}{img\_create}}(IMG\_W+NEW\_IMG\_W,\ IMG\_H,\ \mbox{\hyperlink{kolibri__libimg_8h_ae932abe1baf2fc58d0433104a97afa46afc1f7da9bb85078e43dad49072b4effe}{IMAGE\_BPP32}});\ \ \textcolor{comment}{//\ Create\ an\ empty\ layer}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{kolibri__libimg_8h_abc2e9231ec42609656c796eb8baa9683}{img\_fill\_color}}(image\_blend,\ IMG\_W+NEW\_IMG\_W,\ IMG\_H,\ sys\_color\_table.work\_area);\ \textcolor{comment}{//\ Fill\ the\ layer\ with\ one\ color}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{kolibri__libimg_8h_a8507d388ce1da7b7247b6f0c90a6fce2}{img\_blend}}(image\_blend,\ image,\ 0,\ 0,\ 0,\ 0,\ IMG\_W,\ IMG\_H);\ \ \textcolor{comment}{//\ Blending\ images\ to\ display\ the\ alpha\ channel.\ }}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ Reduce\ image\ size\ from\ 256x256\ to\ 128x128\ */}}
\DoxyCodeLine{\ \ \ \ image\ =\ \mbox{\hyperlink{kolibri__libimg_8h_adc0c1196a66f24a7b0e3978275d80e8a}{img\_scale}}(image,\ 0,\ 0,\ IMG\_W,\ IMG\_H,\ NULL,\ \mbox{\hyperlink{kolibri__libimg_8h_a8e8d3da3ac3510ba6f5aa1a4c8c82eaea7ae43e08fdacda6ab9a9efafa37f92d4}{LIBIMG\_SCALE\_STRETCH}}\ ,\ \mbox{\hyperlink{kolibri__libimg_8h_a100905ea9409684ebb4c0fd0422ab79bae12cfeb29047350fa07610f232743b3f}{LIBIMG\_INTER\_BILINEAR}},\ NEW\_IMG\_W,\ NEW\_IMG\_H);}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{kolibri__libimg_8h_a8507d388ce1da7b7247b6f0c90a6fce2}{img\_blend}}(image\_blend,\ image,\ 256,\ 0,\ 0,\ 0,\ NEW\_IMG\_W,\ NEW\_IMG\_H);\ }
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{kolibri__libimg_8h_af80726e7628ffa475a5bf80bf97d3a07}{img\_destroy}}(image);\ \ \textcolor{comment}{//\ Destroy\ image\ structure}}
\DoxyCodeLine{\ \ \ \ free(file\_data);\ \ \textcolor{comment}{//\ Free\ allocated\ file\_data\ buffer\ }}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ set\_wanted\_events\_mask(0xC0000027);}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ Main\ event\ loop\ */}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{while}\ (1)\ \{\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}(get\_os\_event())\{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{kolibri__gui_8h_a97735f796c03253d408c7e5bdf5f37dca0a84f1803dcad15708cd5bf208a8118a}{KOLIBRI\_EVENT\_REDRAW}}:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ DrawGUI();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{kolibri__gui_8h_a97735f796c03253d408c7e5bdf5f37dca775f06d5461504664e4a97428e9d7a2e}{KOLIBRI\_EVENT\_BUTTON}}:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_os\_button()\ ==\ 1)\{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\}}

\end{DoxyCodeInclude}
 